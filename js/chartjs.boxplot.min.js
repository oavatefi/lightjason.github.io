!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("chart.js")):"function"==typeof define&&define.amd?define(["exports","chart.js"],e):e(t.ChartBoxPlot=t.ChartBoxPlot||{},t.Chart)}(this,function(t,e){"use strict";function i(t){return 1/Math.sqrt(2*Math.PI)*Math.exp(-.5*t*t)}function r(t,e){return t-e}function n(t){var e=function(t,e){var i=(t=t.slice().sort(r)).length-1;return e.map(function(e){if(0===e)return t[0];if(1===e)return t[i];var r=1+e*i,n=Math.floor(r),o=r-n,a=t[n-1];return 0===o?a:a+o*(t[n]-a)})}(t,[.25,.75]);return e[1]-e[0]}function o(t){var e=n(t)/1.34;return 1.06*Math.min(Math.sqrt(function(t){var e=t.length;if(e<1)return NaN;if(1===e)return 0;for(var i=function(t){var e=t.length;if(0===e)return NaN;for(var i=0,r=-1;++r<e;)i+=(t[r]-i)/(r+1);return i}(t),r=-1,n=0;++r<e;){var o=t[r]-i;n+=o*o}return n/(e-1)}(t)),e)*Math.pow(t.length,-.2)}function a(t){const e=t.q3-t.q1;return{whiskerMin:Math.max(t.min,t.q1-e),whiskerMax:Math.min(t.max,t.q3+e)}}function s(t){if(0===t.length)return{outliers:[]};(t=t.filter(t=>"number"==typeof t&&!isNaN(t))).sort((t,e)=>t-e);const e=d(t);return{min:e[0],max:e[1],median:f(t,.5),kde:function(){function t(t,i){var o=n.call(this,r);return t.map(function(t){for(var i=-1,n=0,a=r.length;++i<a;)n+=e((t-r[i])/o);return[t,n/o/a]})}var e=i,r=[],n=o;return t.kernel=function(i){return arguments.length?(e=i,t):e},t.sample=function(e){return arguments.length?(r=e,t):r},t.bandwidth=function(e){return arguments.length?(n=function(t){return"function"==typeof t?t:function(){return t}}(e),t):n},t}().sample(t)}}function l(t){if("number"==typeof t.median&&"number"==typeof t.q1&&"number"==typeof t.q3){if(void 0===t.whiskerMin){const{whiskerMin:e,whiskerMax:i}=a(t);t.whiskerMin=e,t.whiskerMax=i}return t}if(Array.isArray(t))return void 0===t.__stats&&(t.__stats=function(t){if(0===t.length)return{min:NaN,max:NaN,median:NaN,q1:NaN,q3:NaN,whiskerMin:NaN,whiskerMax:NaN,outliers:[]};(t=t.filter(t=>"number"==typeof t&&!isNaN(t))).sort((t,e)=>t-e);const e=d(t),i={min:e[0],max:e[1],median:f(t,.5),q1:f(t,.25),q3:f(t,.75),outliers:[]},{whiskerMin:r,whiskerMax:n}=a(i);return i.outliers=t.filter(t=>t<r||t>n),i.whiskerMin=r,i.whiskerMax=n,i}(t)),t.__stats}function h(t){if(!t)return t;if("number"==typeof t||"string"==typeof t)return Number(t);const e=l(t);return e?e.median:t}function u(t){const e=this.chart,i=this.isHorizontal(),r=t=>i?t.xAxisID===this.id:t.yAxisID===this.id;this.min=null,this.max=null,e.data.datasets.forEach((i,n)=>{const o=e.getDatasetMeta(n);e.isDatasetVisible(n)&&r(o)&&i.data.forEach((e,i)=>{if(!e||o.data[i].hidden)return;const r=function(t){if("number"==typeof t.min&&"number"==typeof t.max)return t;if(Array.isArray(t))return l(t)}(e);r&&(null===this.min?this.min=r.min:r.min<this.min&&(this.min=r.min),null===this.max?this.max=r.max:r.max>this.max&&(this.max=r.max),t&&t(r))})})}var m=function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN},c=(function(t){return 1===t.length&&(t=function(t){return function(e,i){return m(t(e),i)}}(t)),{left:function(e,i,r,n){for(null==r&&(r=0),null==n&&(n=e.length);r<n;){var o=r+n>>>1;t(e[o],i)<0?r=o+1:n=o}return r},right:function(e,i,r,n){for(null==r&&(r=0),null==n&&(n=e.length);r<n;){var o=r+n>>>1;t(e[o],i)>0?n=o:r=o+1}return r}}}(m).right,function(t){return null===t?NaN:+t}),d=function(t,e){var i,r,n,o=t.length,a=-1;if(null==e){for(;++a<o;)if(null!=(i=t[a])&&i>=i)for(r=n=i;++a<o;)null!=(i=t[a])&&(r>i&&(r=i),n<i&&(n=i))}else for(;++a<o;)if(null!=(i=e(t[a],a,t))&&i>=i)for(r=n=i;++a<o;)null!=(i=e(t[a],a,t))&&(r>i&&(r=i),n<i&&(n=i));return[r,n]},f=(Math.sqrt(50),Math.sqrt(10),Math.sqrt(2),function(t,e,i){if(null==i&&(i=c),r=t.length){if((e=+e)<=0||r<2)return+i(t[0],0,t);if(e>=1)return+i(t[r-1],r-1,t);var r,n=(r-1)*e,o=Math.floor(n),a=+i(t[o],o,t);return a+(+i(t[o+1],o+1,t)-a)*(n-o)}});const x=Object.assign({},e.defaults.global.elements.rectangle,{borderWidth:1,outlierRadius:2,itemRadius:2,itemStyle:"circle",itemBackgroundColor:e.defaults.global.elements.rectangle.backgroundColor,itemBorderColor:e.defaults.global.elements.rectangle.borderColor}),g=e.Element.extend({isVertical(){return void 0!==this._view.width},draw(){},_drawItems(t,i,r,n){if(t.itemRadius<=0||!i.items||i.items.length<=0)return;r.save(),r.strokeStle=t.itemBorderColor,r.fillStyle=t.itemBackgroundColor;const o=function(t){return void 0===t&&(t=Date.now()),()=>(t=(9301*t+49297)%233280)/233280}(i.median),a=t.itemRadius;if(n){const{x:n,width:s}=t;i.items.forEach(i=>{e.canvasHelpers.drawPoint(r,t.itemStyle,a,n-s/2+o()*s,i)})}else{const{y:n,height:s}=t;i.items.forEach(i=>{e.canvasHelpers.drawPoint(r,t.itemStyle,a,i,n-s/2+o()*s)})}r.restore()},_drawOutliers(t,e,i,r){if(!e.outliers)return;const n=t.outlierRadius;if(i.beginPath(),r){const r=t.x;e.outliers.forEach(t=>{i.arc(r,t,n,0,2*Math.PI)})}else{const r=t.y;e.outliers.forEach(t=>{i.arc(t,r,n,0,2*Math.PI)})}i.fill(),i.closePath()},_getBounds:()=>({left:0,top:0,right:0,bottom:0}),height:()=>0,inRange(t,e){if(!this._view)return!1;const i=this._getBounds();return t>=i.left&&t<=i.right&&e>=i.top&&e<=i.bottom},inLabelRange(t,e){if(!this._view)return!1;const i=this._getBounds();return this.isVertical()?t>=i.left&&t<=i.right:e>=i.top&&e<=i.bottom},inXRange(t){const e=this._getBounds();return t>=e.left&&t<=e.right},inYRange(t){const e=this._getBounds();return t>=e.top&&t<=e.bottom},getCenterPoint(){const{x:t,y:e}=this._view;return{x:t,y:e}},getArea:()=>0,tooltipPosition_(){return this.getCenterPoint()}});e.defaults.global.elements.boxandwhiskers=Object.assign({},x);const p=e.elements.BoxAndWhiskers=g.extend({draw(){const t=this._chart.ctx,e=this._view,i=e.boxplot,r=this.isVertical();this._drawItems(e,i,t,r),t.save(),t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor,t.lineWidth=e.borderWidth,this._drawBoxPlot(e,i,t,r),this._drawOutliers(e,i,t,r),t.restore()},_drawBoxPlot(t,e,i,r){if(i.beginPath(),r){const{x:r,width:n}=t,o=r-n/2;i.fillRect(o,e.q1,n,e.q3-e.q1),i.strokeRect(o,e.q1,n,e.q3-e.q1),i.moveTo(o,e.whiskerMin),i.lineTo(o+n,e.whiskerMin),i.moveTo(r,e.whiskerMin),i.lineTo(r,e.q1),i.moveTo(o,e.whiskerMax),i.lineTo(o+n,e.whiskerMax),i.moveTo(r,e.whiskerMax),i.lineTo(r,e.q3),i.moveTo(o,e.median),i.lineTo(o+n,e.median)}else{const{y:r,height:n}=t,o=r-n/2;i.fillRect(e.q1,o,e.q3-e.q1,n),i.strokeRect(e.q1,o,e.q3-e.q1,n),i.moveTo(e.whiskerMin,o),i.lineTo(e.whiskerMin,o+n),i.moveTo(e.whiskerMin,r),i.lineTo(e.q1,r),i.moveTo(e.whiskerMax,o),i.lineTo(e.whiskerMax,o+n),i.moveTo(e.whiskerMax,r),i.lineTo(e.q3,r),i.moveTo(e.median,o),i.lineTo(e.median,o+n)}i.stroke(),i.closePath()},_getBounds(){const t=this._view,e=this.isVertical(),i=t.boxplot;if(e){const{x:e,width:r}=t,n=e-r/2;return{left:n,top:i.whiskerMax,right:n+r,bottom:i.whiskerMin}}const{y:r,height:n}=t,o=r-n/2;return{left:i.whiskerMin,top:o,right:i.whiskerMax,bottom:o+n}},height(){const t=this._view;return t.base-Math.min(t.boxplot.q1,t.boxplot.q3)},getArea(){const t=this._view,e=Math.abs(t.boxplot.q3-t.boxplot.q1);return this.isVertical()?e*t.width:e*t.height}});e.defaults.global.elements.violin=Object.assign({points:100},x);const v=e.elements.Violin=g.extend({draw(){const t=this._chart.ctx,i=this._view,r=i.violin,n=this.isVertical();this._drawItems(i,r,t,n),t.save(),t.fillStyle=i.backgroundColor,t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth;const o=r.coords;if(e.canvasHelpers.drawPoint(t,"rectRot",5,i.x,i.y),t.stroke(),t.beginPath(),n){const{x:e,width:n}=i,a=n/2/r.maxEstimate;t.moveTo(e,r.min),o.forEach(({v:i,estimate:r})=>{t.lineTo(e-r*a,i)}),t.lineTo(e,r.max),t.moveTo(e,r.min),o.forEach(({v:i,estimate:r})=>{t.lineTo(e+r*a,i)}),t.lineTo(e,r.max)}else{const{y:e,height:n}=i,a=n/2/r.maxEstimate;t.moveTo(r.min,e),o.forEach(({v:i,estimate:r})=>{t.lineTo(i,e-r*a)}),t.lineTo(r.max,e),t.moveTo(r.min,e),o.forEach(({v:i,estimate:r})=>{t.lineTo(i,e+r*a)}),t.lineTo(r.max,e)}t.stroke(),t.fill(),t.closePath(),this._drawOutliers(i,r,t,n),t.restore()},_getBounds(){const t=this._view,e=this.isVertical(),i=t.violin;if(e){const{x:e,width:r}=t,n=e-r/2;return{left:n,top:i.max,right:n+r,bottom:i.min}}const{y:r,height:n}=t,o=r-n/2;return{left:i.min,top:o,right:i.max,bottom:o+n}},height(){const t=this._view;return t.base-Math.min(t.violin.min,t.violin.max)},getArea(){const t=this._view,e=Math.abs(t.violin.max-t.violin.min);return this.isVertical()?e*t.width:e*t.height}}),b={scales:{yAxes:[{type:"arrayLinear"}]}},w={scales:{xAxes:[{type:"arrayLinear"}]}},y={_elementOptions:()=>({}),updateElement(t,i,r){const n=this.getDataset(),o=t.custom||{},a=this._elementOptions();e.controllers.bar.prototype.updateElement.call(this,t,i,r),["outlierRadius","itemRadius","itemStyle","itemBackgroundColor","itemBorderColor"].forEach(r=>{t._model[r]=void 0!==o[r]?o[r]:e.helpers.valueAtIndexOrDefault(n[r],i,a[r])})},_calculateCommonModel(t,e,i,r){i.outliers&&(t.outliers=i.outliers.map(t=>r.getPixelForValue(Number(t)))),Array.isArray(e)&&(t.items=e.map(t=>r.getPixelForValue(Number(t))))}},k={tooltips:{callbacks:{label(t,e){const i=e.datasets[t.datasetIndex].label||"",r=l(e.datasets[t.datasetIndex].data[t.index]);let n=`${i} ${"string"==typeof t.xLabel?t.xLabel:t.yLabel}`;return r?`${n} (min: ${r.min}, q1: ${r.q1}, median: ${r.median}, q3: ${r.q3}, max: ${r.max})`:n+"NaN"}}}};e.defaults.boxplot=e.helpers.merge({},[e.defaults.bar,b,k]),e.defaults.horizontalBoxplot=e.helpers.merge({},[e.defaults.horizontalBar,w,k]);const M=Object.assign({},y,{dataElementType:e.elements.BoxAndWhiskers,_elementOptions(){return this.chart.options.elements.boxandwhiskers},updateElementGeometry(t,i,r){e.controllers.bar.prototype.updateElementGeometry.call(this,t,i,r),t._model.boxplot=this._calculateBoxPlotValuesPixels(this.index,i)},_calculateBoxPlotValuesPixels(t,e){const i=this.getValueScale(),r=this.chart.data.datasets[t].data[e],n=l(r),o={};return Object.keys(n).forEach(t=>{"outliers"!==t&&(o[t]=i.getPixelForValue(Number(n[t])))}),this._calculateCommonModel(o,r,n,i),o}}),_=e.controllers.boxplot=e.controllers.bar.extend(M),q=e.controllers.horizontalBoxplot=e.controllers.horizontalBar.extend(M),T={};e.defaults.violin=e.helpers.merge({},[e.defaults.bar,b,T]),e.defaults.horizontalViolin=e.helpers.merge({},[e.defaults.horizontalBar,w,T]);const N=Object.assign({},y,{dataElementType:e.elements.Violin,_elementOptions(){return this.chart.options.elements.violin},updateElementGeometry(t,i,r){e.controllers.bar.prototype.updateElementGeometry.call(this,t,i,r);const n=t.custom||{},o=this._elementOptions();t._model.violin=this._calculateViolinValuesPixels(this.index,i,void 0!==n.points?n.points:o.points)},_calculateViolinValuesPixels(t,e,i){const r=this.getValueScale(),n=this.chart.data.datasets[t].data[e],o=function(t){if("number"==typeof t.median&&("function"==typeof t.kde||Array.isArray(t.coords)))return t;if(Array.isArray(t))return void 0===t.__kde&&(t.__kde=s(t)),t.__kde}(n),a=o.max-o.min,l=function(t,e,i){t=+t,e=+e,i=(n=arguments.length)<2?(e=t,t=0,1):n<3?1:+i;for(var r=-1,n=0|Math.max(0,Math.ceil((e-t)/i)),o=new Array(n);++r<n;)o[r]=t+r*i;return o}(o.min,o.max,a/i);l[l.length-1]!==o.max&&l.push(o.max);const h=o.coords||o.kde(l).map(t=>({v:t[0],estimate:t[1]})),u={min:r.getPixelForValue(o.min),max:r.getPixelForValue(o.max),median:r.getPixelForValue(o.median),coords:h.map(({v:t,estimate:e})=>({v:r.getPixelForValue(t),estimate:e})),maxEstimate:function(t,e){var i,r,n=t.length,o=-1;if(null==e){for(;++o<n;)if(null!=(i=t[o])&&i>=i)for(r=i;++o<n;)null!=(i=t[o])&&i>r&&(r=i)}else for(;++o<n;)if(null!=(i=e(t[o],o,t))&&i>=i)for(r=i;++o<n;)null!=(i=e(t[o],o,t))&&i>r&&(r=i);return r}(h,t=>t.estimate)};return this._calculateCommonModel(u,n,o,r),u}}),P=(e.controllers.violin=e.controllers.bar.extend(N),e.controllers.horizontalViolin=e.controllers.horizontalBar.extend(N)),V=e.scaleService.getScaleConstructor("linear").extend({getRightValue(t){return e.LinearScaleBase.prototype.getRightValue.call(this,h(t))},determineDataLimits(){u.call(this),this.handleTickRangeOptions()}});e.scaleService.registerScaleType("arrayLinear",V,e.scaleService.getScaleDefaults("linear"));const B=e.helpers,S=e.scaleService.getScaleConstructor("logarithmic").extend({getRightValue(t){return e.LinearScaleBase.prototype.getRightValue.call(this,h(t))},determineDataLimits(){this.minNotZero=null,u.call(this,t=>{0!==t.min&&(null===this.minNotZero||t.min<this.minNotZero)&&(this.minNotZero=t.min)});const t=this.options.ticks;this.min=B.valueOrDefault(t.min,this.min-.05*this.min),this.max=B.valueOrDefault(t.max,this.max+.05*this.max),this.min===this.max&&(0!==this.min&&null!==this.min?(this.min=Math.pow(10,Math.floor(B.log10(this.min))-1),this.max=Math.pow(10,Math.floor(B.log10(this.max))+1)):(this.min=1,this.max=10))}});e.scaleService.registerScaleType("arrayLogarithmic",S,e.scaleService.getScaleDefaults("logarithmic")),t.BoxAndWhiskers=p,t.Violin=v,t.ArrayLinearScale=V,t.ArrayLogarithmicScale=S,t.BoxPlot=_,t.HorizontalBoxPlot=q,t.HorizontalViolin=P,Object.defineProperty(t,"__esModule",{value:!0})});